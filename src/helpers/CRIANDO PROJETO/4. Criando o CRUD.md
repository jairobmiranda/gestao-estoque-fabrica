# ü™Ñ Criando o CRUD para Atividades

### ‚úÖ . Confirme se seu `schema.prisma` cont√©m a entidade respons√°vel.

```prisma
model Atividade {
  id          Int      @id @default(autoincrement())
  descricao   String
  dataInicio  DateTime
  dataFim     DateTime

  @@map("atividades")
}
```

### ‚úÖ . Execute o comando para criar o resource do CRUD

Ao executar o comando, selecione `API REST`, depois `Yes` para criar o CRUD Completo.

```bash
npx nest g resource atividade --no-spec
```

### ‚úÖ . Edite o Entity

A classe `Entity` representa o retorno de um objeto oriundo de uma tabela no banco de dados.

Abra o arquivo `atividade.entity.ts` e altere o nome da Class adicionando `Entity` no final. No caso `AtividadeEntity`.

```typescript
export class AtividadeEntity {
  id: number;
  descricao: string;
  dataInicio: Date;
  dataFim: Date;
}
```

### ‚úÖ . Edite os DTOs

**DTO** significa _`"Data Transfer Object"`_ _(Objeto de Transfer√™ncia de Dados)_. √â um padr√£o de design usado para transferir dados entre diferentes camadas de uma aplica√ß√£o, especialmente entre a camada de apresenta√ß√£o (frontend) e a camada de neg√≥cios (backend).

Dentro do nosso **DTO**, j√° iremos fazer algumas valida√ß√µes de valores, portanto, fa√ßa a instala√ß√£o das depend√™ncias do `class-validator`.

```bash
npm install class-validator
```

Abra o arquivo `create-atividade.dto.ts`

```typescript
import { IsNotEmpty, IsString } from "class-validator";

export class CreateAtividadeDto {
  @IsNotEmpty()
  @IsString()
  descricao: string;

  @IsNotEmpty()
  dataInicio: Date;

  @IsNotEmpty()
  dataFim: Date;
}
```

### ‚úÖ . Crie o repository para a entidade Atividade

Crie um arquivo chamado `atividade.repository.ts` dentro da pasta `src/atividade/repository` e adicione o seguinte c√≥digo:

```typescript
import { Injectable } from "@nestjs/common";
import { Atividade } from "@prisma/client";
import { PrismaService } from "src/prisma/prisma.service";
import { CreateAtividadeDto } from "../dto/create-atividade.dto";
import { UpdateAtividadeDto } from "../dto/update-atividade.dto";

@Injectable()
export class AtividadeRepository {
  constructor(private readonly prisma: PrismaService) {}

  async findAll(): Promise<Atividade[]> {
    return this.prisma.atividade.findMany();
  }

  async findOne(id: number): Promise<Atividade> {
    const atividade = await this.prisma.atividade.findUnique({ where: { id } });
    if (!atividade) {
      throw new Error(`Id ${id} n√£o encontrado`);
    }
    return atividade;
  }

  async create(objectCreate: CreateAtividadeDto): Promise<Atividade> {
    return this.prisma.atividade.create({ data: objectCreate });
  }

  async update(id: number, data: UpdateAtividadeDto): Promise<Atividade> {
    return this.prisma.atividade.update({ where: { id }, data });
  }

  async delete(id: number): Promise<Atividade> {
    return this.prisma.atividade.delete({ where: { id } });
  }
}
```

### ‚úÖ . Escrevendo os m√©todos do Service

Abra o arquivo `atividade.service.ts`

```typescript
import { PrismaClient } from "@prisma/client";

export class AtividadeService {
  private prisma: PrismaClient;

  constructor() {
    this.prisma = new PrismaClient();
  }

  async findAll() {
    return this.prisma.atividade.findMany();
  }

  async findOne(id: number) {
    return this.prisma.atividade.findUnique({
      where: { id },
    });
  }

  async create(data: any) {
    return this.prisma.atividade.create({
      data,
    });
  }

  async update(id: number, data: any) {
    return this.prisma.atividade.update({
      where: { id },
      data,
    });
  }

  async remove(id: number) {
    return this.prisma.atividade.delete({
      where: { id },
    });
  }
}
```
